<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>html</title>
	<link rel="stylesheet" type="text/css" href="../../js/easyui/themes/bootstrap/easyui.css">
	<link rel="stylesheet" type="text/css" href="../../js/easyui/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="../../js/selfcss/demo.css">
	<script type="text/javascript" src="../../js/easyui/jquery.min.js"></script>
	<script type="text/javascript" src="../../js/easyui/jquery.easyui.min.js"></script>
</head>
	<body class="easyui-layout" fit="true" id="body" >
        <div data-options="region:'north',title:'查询条件',hideCollapsedContent:false,collapsed:false" style="height:80px;" id="north">
          <div style="width: 65%;float:left;">
           <form id="ff" style="text-align: center;margin-top: 15px;margin-left: 15px;" method="post"> 
		    	<table cellpadding="0" cellspacing="0" class="table-striped">
		    		<tr>
		    		   		    		   
		    		      <td>任务组：</td>
		    		      <td>
		    			   <input class="easyui-combobox" data-options="
							valueField: 'label',
							textField: 'value',
							url:'../../searchSelectPsDicts?moudle=SYS_GROUP'" name="jobGroup"/>
		    			 </td>
		    		   
		    		      <td>任务名：</td>
		    		      <td>
		    			  <input name="jobName" id="jobName" type="text" class="easyui-validatebox txt"/>
		    			 </td>

		    		</tr>
		    	</table>
		    </form>
          </div>
          <div style="width: 30%;float:right;margin-top: 15px;">
            <a href="javascript:Handler.searchData()" class="easyui-linkbutton"  style="width:80px">查询</a>
            <a href="javascript:Handler.resetFormData()" class="easyui-linkbutton"  style="width:80px">重置</a>
          </div>
        </div>
        
        <div data-options="region:'center',split:false" >
			<table id="tablelist" class="easyui-datagrid"  style="width:auto;" fitcolumns="true" fit="true" 
			data-options="singleSelect:true,pagination:true,url:'../../searchAutoPageSystemQrtzTriggerInfos',method:'get',toolbar:toolbar">
				<thead>
					<tr>					   
					    <th data-options="field:'ck',checkbox:true"></th>
						<th data-options="field:'jobGroupName',width:100,align:'center'">任务组</th>
						<th data-options="field:'jobName',width:100,align:'center'">任务名</th>
						<th data-options="field:'jobStatus',width:100,align:'center'">任务状态</th>
						<th data-options="field:'jobCron',width:100,align:'center'">cron表达式</th>
						<th data-options="field:'className',width:100,align:'center'">类名</th>						
						<th data-options="field:'jobClassName',width:100,align:'center'">调用方式</th>
						<th data-options="field:'author',width:100,align:'center'">负责人</th>
						<th data-options="field:'alarmEmail',width:80,align:'center'">报警邮件</th>
						<th data-options="field:'alarmThreshold',width:80,align:'center'">报警阀值</th>
						<th data-options="field:'addTimeString',width:120,align:'center'">修改时间</th>
						
					</tr>
				</thead>
			</table>
		</div>
		<div id="formwin" class="easyui-window"  data-options="iconCls:'icon-save',closed:true" >
		   <form id="infoForm" method="post" style="text-align: center;margin-top: 20px;margin-left: 50px;">
			    <input type="hidden" id="id" name="id" />
			  	<table class="common-table" style="border-collapse:separate; border-spacing:15px;" cellspacing="15" cellpadding="0">
			  	  <tr>
			  	    <th>任务组：</th>
			  	     <td>
		    			   <input class="easyui-combobox" data-options="
							valueField: 'label',
							textField: 'value',
							url:' ../../searchSelectPsDicts?moudle=SYS_GROUP'" name="jobGroup"/>
			  	     </td>
			  	    <th>任务名：</th>
			  	     <td>
		    			  <input name="jobName" id="jobName" type="text" class="easyui-validatebox txt"/>
			  	     </td>
			  	    </tr>
			  	  <tr>
			  	    <th>cron表达式：</th>
			  	     <td>
		    			  <input name="jobCron" id="jobCron" type="text" class="easyui-validatebox txt"/>
			  	     </td>
			  	     <th>负责人：</th>
			  	     <td>
		    			  <input name="author" id="author" type="text" class="easyui-validatebox txt"/>
			  	     </td>
			  	  </tr>
			  	  <tr>
			  	    <th>调用方式：</th>
			  	     <td>
		    			 
							<input class="easyui-combobox" data-options="
							valueField: 'label',
							textField: 'value',
							url:' ../../searchSelectPsDicts?moudle=OPERATE'" name="jobClass"/>
			  	     </td>
			  	     <th>类名：</th>
			  	     <td>
		    			  <input name="className" id="className" type="text" class="easyui-validatebox txt"/>
			  	     </td>
			  	  </tr>   			  	    
			  	  <tr>			  	    
			  	    <th>报警邮件：</th>
			  	     <td>
		    			  <input name="alarmEmail" id="alarmEmail" type="text" class="easyui-validatebox txt"/>
			  	     </td>
			  	     <th>报警阀值：</th>
			  	     <td>
		    			  <input name="alarmThreshold" id="alarmThreshold" type="text" class="easyui-validatebox txt"/>
			  	     </td>
			  	    </tr>
			  	   <tr>
			  	   </tr>
			  	</table>
			  	<table>
			  	 <tr>
			  	   <th>任务描述：</th>
			  	     <td>
		    			  <input name="jobDesc" id="jobDesc" type="test" class="easyui-textbox" multiline="true" style="width:500px;height:100px" />
			  	     </td>
			  	 </tr>   
			  	</table>
  			</form>
  			<div id="dlg-buttons2" style="text-align: center;vertical-align: middle;margin-top: 20px;">
				
				<a href="javascript:void(0)" class="easyui-linkbutton c5"
					onclick="javascript:$('#formwin').window('close');"
					style="width: 90px">关闭</a>					
				<a href="javascript:void(0)" class="easyui-linkbutton c6"
					 onclick="javascript:Handler.saveData();" style="width: 90px">保存</a>	
			</div>
    	</div>
		<script type="text/javascript">
        var toolbar = [{
            text:'新增',
            iconCls:'icon-add',
            handler:function(){Handler.addData()}
        },'-',{
            text:'删除',
            iconCls:'icon-cut',
            handler:function(){Handler.deleteData()}
        },'-',{
            text:'编辑',
            iconCls:'icon-save',
            handler:function(){Handler.editData()}
        },'-',{
            text:'暂停',
            iconCls:'icon-save',
            handler:function(){Handler.pause()}
        },'-',{
            text:'恢复',
            iconCls:'icon-save',
            handler:function(){Handler.resume()}
        },'-',{
            text:'执行',
            iconCls:'icon-save',
            handler:function(){Handler.trigger()}
        },'-',{
            text:'查询',
            iconCls:'icon-search',
            handler:function(){Handler.searchDataById()}
        }];
      //设置分页控件  
      $(document).ready(function() {
    	  var p = $('#tablelist').datagrid('getPager');  
          p.pagination({  
              pageSize: 10,//每页显示的记录条数，默认为10  
              pageList: [10, 20, 50],//可以设置每页记录条数的列表  
              beforePageText: '第',//页数文本框前显示的汉字  
              afterPageText: '页    共 {pages} 页',  
              displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'  
          });  
      });
      var Handler = {
    			deleteData: function(){ 
      			  var rowsChecked = $('#tablelist').datagrid('getChecked');
      			  $.messager.confirm('信息提示', '确认是否删除数据?', function(r){
      	                if (r){
      	                	$.post("../../removeAutoPageSystemQrtzTriggerInfo",{id:rowsChecked[0].id},function(data,state){
      	    					 if(state=="success" && data.status==200){
      	    						 $('#tablelist').datagrid('reload'); 
      	    						 $('#ff').form('clear');
      	    					 }else{
      	    						 $.messager.alert('失败信息',data.message,'error');
      	    					 }	
      	  					},"json");
      	                }
      	            }); 
      			},
      			pause: function(){ 
        			  var rowsChecked = $('#tablelist').datagrid('getChecked');
        			  $.messager.confirm('信息提示', '确认是否暂停?', function(r){
        	                if (r){
        	                	$.post("../../pause",{id:rowsChecked[0].id},function(data,state){
        	    					 if(state=="success" && data.status==200){
        	    						 $('#tablelist').datagrid('reload'); 
        	    						 $('#ff').form('clear');
        	    					 }else{
        	    						 $.messager.alert('失败信息',data.message,'error');
        	    					 }	
        	  					},"json");
        	                }
        	            }); 
        	  },	
        	  resume: function(){ 
    			  var rowsChecked = $('#tablelist').datagrid('getChecked');
    			  $.messager.confirm('信息提示', '确认是否恢复?', function(r){
    	                if (r){
    	                	$.post("../../resume",{id:rowsChecked[0].id},function(data,state){
    	    					 if(state=="success" && data.status==200){
    	    						 $('#tablelist').datagrid('reload'); 
    	    						 $('#ff').form('clear');
    	    					 }else{
    	    						 $.messager.alert('失败信息',data.message,'error');
    	    					 }	
    	  					},"json");
    	                }
    	            }); 
    	 		 },
    	 		trigger: function(){ 
      			  var rowsChecked = $('#tablelist').datagrid('getChecked');
      			  $.messager.confirm('信息提示', '确认是是否执行?', function(r){
      	                if (r){
      	                	$.post("../../trigger",{id:rowsChecked[0].id},function(data,state){
      	    					 if(state=="success" && data.status==200){
      	    						 $('#tablelist').datagrid('reload'); 
      	    						 $('#ff').form('clear');
      	    					 }else{
      	    						 $.messager.alert('失败信息',data.message,'error');
      	    					 }	
      	  					},"json");
      	                }
      	            }); 
      	 		 },	 
      		  resetFormData: function(){
      			$('#ff').form('clear');
      		  },
      		  searchData: function(){
      			  var params=getFormData("ff");
      			  $('#tablelist').datagrid('load',params);
      		  },
      		searchDataById: function(){
      			var rowsChecked = $('#tablelist').datagrid('getChecked');
      			var url="../../"+rowsChecked[0].id+"/searchAutoPageSystemQrtzTriggerInfo";
      			$.get(url, function(data){
    				if(data.status==200){
    					$('#infoForm').form('load', data.data);
    					$("#dlg-buttons2").css('display','none');
    				}
    			},"json");
      			openWindow("formwin","查询页面","icon-search");
    		  },
      		 addData: function(){
      			$('#infoForm').form('clear');
      			$("#dlg-buttons2").css('display','block');
      			openWindow("formwin","新增页面","icon-add");
      		  },
      		editData: function(){
      			$('#infoForm').form('clear');
      			var rowsChecked = $('#tablelist').datagrid('getChecked');
      			var url="../../"+rowsChecked[0].id+"/searchAutoPageSystemQrtzTriggerInfo";
      			$.get(url, function(data){
    				if(data.status==200){
    					$('#infoForm').form('load', data.data);
    					$("#dlg-buttons2").css('display','block');
    				}
    			},"json");
      			openWindow("formwin","编辑页面","icon-edit");
      		  },
       		 saveData: function(){
       			 var params=getFormData("infoForm");
       			 var url="";
       			 if(params.id){//存在
       				url="../../editAutoPageSystemQrtzTriggerInfo";
       			 }else{
       				 url="../../autoPageSystemQrtzTriggerInfo";
       			 }
       			 $.post(url,params,function(data,state){
					 if(state=="success" && data.status==200){
						 $('#infoForm').form('clear');
						 $('#formwin').window('close');
						 var params=getFormData("ff");
		      			 $('#tablelist').datagrid('load',params);
					 }else{
						 $.messager.alert('失败信息',data.message,'error');
						 $('#infoForm').form('clear');
					 }	
					},"json");
       		  }
      };
      function getFormData(id){
    	    var data = $("#"+id).serializeArray();
    		var item,key,value,newData={};
    		for(var i=0;i<data.length;i++){
    			item = data[i];
    			key = item.name;
    			if(item.value){
    				value = item.value;
        			newData[key] = value;
    			}
    		}	
    		return newData;
    	}
      
      function openWindow(id,title,iconcls){
    	  $('#'+id).window({
			    width:850,
			    height:400,
			    top:($("#body").height() - 400) * 0.5,   
              	left:($("#body").width() - 800) * 0.5,
              	shadow: true,
              	collapsible:false,
              	minimizable:false,
              	maximizable:false,
              	iconCls:iconcls,
			    title:title,
			    modal:true
			});
			 $('#'+id).window('open');
      }
    </script>
		
	</body>
	
</html>